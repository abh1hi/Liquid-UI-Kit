<link rel="stylesheet" href="components/advanced/drag-drop/drag-drop.css">

<div class="kanban-board">
    <!-- Todo Column -->
    <div class="kanban-column">
        <div class="kanban-header">
            <span class="kanban-title text-secondary">To Do</span>
            <span class="kanban-count">3</span>
        </div>
        <div class="kanban-items" id="todo-col">
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Research Competitors</h4>
                <p class="text-xs text-secondary">Analyze top 3 apps in the market</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-design">Research</span>
                </div>
            </div>
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Draft User Stories</h4>
                <p class="text-xs text-secondary">Define core user flows</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-design">Product</span>
                </div>
            </div>
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Setup Repo</h4>
                <p class="text-xs text-secondary">Initialize Git and CI/CD</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-dev">DevOps</span>
                </div>
            </div>
        </div>
    </div>

    <!-- In Progress Column -->
    <div class="kanban-column">
        <div class="kanban-header">
            <span class="kanban-title text-primary">In Progress</span>
            <span class="kanban-count">2</span>
        </div>
        <div class="kanban-items" id="progress-col">
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Design System</h4>
                <p class="text-xs text-secondary">Create color palette and typography</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-design">Design</span>
                </div>
            </div>
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Login API</h4>
                <p class="text-xs text-secondary">Implement JWT auth endpoints</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-dev">Backend</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Done Column -->
    <div class="kanban-column">
        <div class="kanban-header">
            <span class="kanban-title text-success">Done</span>
            <span class="kanban-count">1</span>
        </div>
        <div class="kanban-items" id="done-col">
            <div class="kanban-card" draggable="true">
                <h4 class="font-medium mb-xs">Fix Login Bug</h4>
                <p class="text-xs text-secondary">Resolved session timeout issue</p>
                <div class="kanban-tags">
                    <span class="kanban-tag tag-bug">Bug</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Simple Drag and Drop Logic
    (function () {
        const cards = document.querySelectorAll('.kanban-card');
        const columns = document.querySelectorAll('.kanban-items');
        let draggedItem = null;

        cards.forEach(card => {
            card.addEventListener('dragstart', () => {
                draggedItem = card;
                setTimeout(() => card.classList.add('dragging'), 0);
            });

            card.addEventListener('dragend', () => {
                setTimeout(() => {
                    draggedItem = null;
                    card.classList.remove('dragging');
                }, 0);
            });
        });

        columns.forEach(column => {
            column.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(column, e.clientY);
                if (afterElement == null) {
                    column.appendChild(draggedItem);
                } else {
                    column.insertBefore(draggedItem, afterElement);
                }
            });
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.kanban-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
    })();
</script>