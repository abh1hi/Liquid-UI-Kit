<link rel="stylesheet" href="components/forms-advanced/date-picker/date-picker.css">

<div class="flex flex-col gap-xl">
    <div class="text-center mb-md">
        <h2 class="text-h2">Date Picker</h2>
        <p class="text-body">Select dates from a calendar.</p>
    </div>

    <section class="glass-panel p-xl" style="min-height: 450px;">
        <div class="flex justify-center">
            <div class="date-picker-container" id="demo-date-picker">
                <div class="date-input-wrapper">
                    <input type="text" class="date-input" placeholder="Select a date" readonly>
                    <span class="material-icons-round calendar-icon">event</span>
                </div>

                <div class="calendar-popup">
                    <div class="calendar-header">
                        <button class="month-nav" id="prev-month">
                            <span class="material-icons-round">chevron_left</span>
                        </button>
                        <span class="current-month" id="current-month-display">November 2023</span>
                        <button class="month-nav" id="next-month">
                            <span class="material-icons-round">chevron_right</span>
                        </button>
                    </div>

                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Weekdays -->
                        <div class="weekday">Su</div>
                        <div class="weekday">Mo</div>
                        <div class="weekday">Tu</div>
                        <div class="weekday">We</div>
                        <div class="weekday">Th</div>
                        <div class="weekday">Fr</div>
                        <div class="weekday">Sa</div>

                        <!-- Days will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    (function () {
        const container = document.getElementById('demo-date-picker');
        const input = container.querySelector('.date-input');
        const popup = container.querySelector('.calendar-popup');
        const grid = document.getElementById('calendar-grid');
        const monthDisplay = document.getElementById('current-month-display');
        const prevBtn = document.getElementById('prev-month');
        const nextBtn = document.getElementById('next-month');

        let currentDate = new Date();
        let selectedDate = null;

        // Toggle Popup
        input.addEventListener('click', (e) => {
            e.stopPropagation();
            container.classList.toggle('open');
        });

        // Close on click outside
        document.addEventListener('click', (e) => {
            if (!container.contains(e.target)) {
                container.classList.remove('open');
            }
        });

        popup.addEventListener('click', (e) => e.stopPropagation());

        // Render Calendar
        function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();

            // Update Header
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            monthDisplay.textContent = `${monthNames[month]} ${year}`;

            // Clear days (keep weekdays)
            const days = grid.querySelectorAll('.day');
            days.forEach(d => d.remove());

            // Get first day of month and total days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Empty slots
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day empty';
                grid.appendChild(empty);
            }

            // Days
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                dayEl.textContent = i;

                // Check Today
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayEl.classList.add('today');
                }

                // Check Selected
                if (selectedDate && i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                    dayEl.classList.add('selected');
                }

                dayEl.addEventListener('click', () => {
                    selectedDate = new Date(year, month, i);
                    input.value = selectedDate.toLocaleDateString();
                    container.classList.remove('open');
                    renderCalendar(currentDate); // Re-render to update selection
                });

                grid.appendChild(dayEl);
            }
        }

        // Navigation
        prevBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        });

        nextBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        });

        // Initial Render
        renderCalendar(currentDate);
    })();
</script>